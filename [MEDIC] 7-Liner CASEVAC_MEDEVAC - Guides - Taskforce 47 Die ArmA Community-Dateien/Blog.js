var Blog={};Blog.Category={};Blog.Category.MarkAllAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(){this._proxy.setOption("data",{actionName:"markAllAsRead",className:"blog\\data\\category\\BlogCategoryAction"});this._proxy.sendRequest()},_success:function(c,d,b){var a=$(".nestedCategoryList");a.find(".badge.badgeUpdate").hide();$("#mainMenu .active .badge").hide()}});Blog.Entry={};Blog.Entry.Delete=WCF.Action.Delete.extend({_redirectURL:"",init:function(b,a,c){this._super(b,a);this._redirectURL=c},_success:function(b,d,a){var c=new WCF.System.Notification(WCF.Language.get("blog.entry.delete.success"));c.show($.proxy(function(){window.location=this._redirectURL},this))}});Blog.Entry.InlineEditor=WCF.InlineEditor.extend({_environment:"list",_redirectURL:"",setRedirectURL:function(b,a){this._redirectURL=b;this._environment=a||"list"},_setOptions:function(){this._options=[{label:WCF.Language.get("blog.entry.enable"),optionName:"enable"},{label:WCF.Language.get("blog.entry.disable"),optionName:"disable"},{label:WCF.Language.get("blog.entry.trash"),optionName:"trash"},{label:WCF.Language.get("blog.entry.restore"),optionName:"restore"},{label:WCF.Language.get("blog.entry.delete"),optionName:"delete"},{optionName:"divider"},{label:WCF.Language.get("wcf.global.button.edit"),optionName:"edit",isQuickOption:true}]},_show:function(c){var d=$(c.currentTarget).data("elementID");var a=null;if(!this._dropdowns[d]){a=this._getTriggerElement(this._elements[d]).addClass("dropdownToggle").parent().addClass("dropdown").end();this._dropdowns[d]=$('<ul class="dropdownMenu" />').insertAfter(a)}this._super(c);if(a!==null){WCF.Dropdown.initDropdown(a,true);var b=a.parent().wcfIdentify();WCF.Dropdown.registerCallback(b,$.proxy(this._toggleDropdown,this));this._toggleDropdown(b,"open")}return false},_toggleDropdown:function(a,b){WCF.Dropdown.getDropdown(a).parents(".messageOptions").toggleClass("forceOpen")},_getTriggerElement:function(a){return a.find(".jsButtonEntryInlineEditor")},_validate:function(a,c){var b=$("#"+a);switch(c){case"delete":if(!b.data("canDeleteEntry")){return false}if(b.data("isDeleted")){return true}break;case"restore":if(!b.data("canRestoreEntry")){return false}if(b.data("isDeleted")){return true}break;case"trash":if(!b.data("canTrashEntry")){return false}if(!b.data("isDeleted")){return true}break;case"enable":case"disable":if(!b.data("canModerateEntry")){return false}if(b.data("isDeleted")){return false}if(b.data("isDisabled")){return(c==="enable")}else{return(c==="disable")}break;case"edit":if(!b.data("canEditEntry")){return false}return true;break}return false},_execute:function(a,c){if(!this._validate(a,c)){return false}switch(c){case"disable":case"enable":this._updateEntry(a,c,{isDisabled:(c==="enable"?0:1)});break;case"delete":var b=this;WCF.System.Confirmation.show(WCF.Language.get("blog.entry.delete.confirmMessage"),function(d){if(d==="confirm"){b._updateEntry(a,c,{deleted:1})}});break;case"edit":window.location=this._getTriggerElement($("#"+a)).prop("href");break;case"restore":this._updateEntry(a,c,{isDeleted:0});break;case"trash":var b=this;WCF.System.Confirmation.show(WCF.Language.get("blog.entry.trash.confirmMessage"),function(d){if(d==="confirm"){b._updateEntry(a,c,{isDeleted:1,reason:$("#wcfSystemConfirmationContent").find("textarea").val()})}},{},$("<fieldset><dl><dt>"+WCF.Language.get("blog.entry.trash.reason")+'</dt><dd><textarea cols="40" rows="4" /></dd></dl></fieldset>'));break}},_updateEntry:function(b,d,e){if(d==="delete"){var c=this;var a=this._elements[b].data("objectID");new WCF.Action.Proxy({autoSend:true,data:{actionName:"delete",className:"blog\\data\\entry\\EntryAction",objectIDs:[a]},success:function(f){if(c._redirectURL){window.location=c._redirectURL}else{window.location.reload()}}})}else{this._updateData.push({data:e,elementID:b,optionName:d});this._proxy.setOption("data",{actionName:d,className:"blog\\data\\entry\\EntryAction",objectIDs:[this._elements[b].data("objectID")],parameters:{data:e}});this._proxy.sendRequest()}},_updateState:function(){if(this._environment=="entry"&&this._updateData.length==1&&this._updateData[0].optionName=="trash"&&!this._elements[this._updateData[0].elementID].data("canViewDeletedEntry")){this._notification.show($.proxy(function(){window.location=this._redirectURL},this));return}this._notification.show();for(var d=0,c=this._updateData.length;d<c;d++){var b=this._updateData[d];var a=$("#"+b.elementID);switch(b.optionName){case"disable":case"enable":a.toggleClass("messageDisabled").data("isDisabled",b.data.isDisabled);break;case"restore":case"trash":a.toggleClass("messageDeleted").data("isDeleted",b.data.isDeleted);break}}}});Blog.Entry.Like=WCF.Like.extend({_getContainers:function(){return $("article")},_getObjectID:function(a){return this._containers[a].data("objectID")},_getWidgetContainer:function(a){return this._containers[a].find(".messageHeader")},_buildWidget:function(b,a,e,d,f){var g=this._getWidgetContainer(b);if(this._canLike){var c=this._containers[b].find(".smallButtons");a.insertBefore(c.find(".toTopLink"));e.insertBefore(c.find(".toTopLink"));e.find("a").addClass("button");a.find("a").addClass("button")}if(f){f.appendTo(this._containers[b].find(".messageBody > .messageFooter"));f.addClass("messageFooterNote")}g.find(".permalink").after(d)},_setActiveState:function(a,b,c){a=a.find(".button").removeClass("active");b=b.find(".button").removeClass("active");if(c==1){a.addClass("active")}else{if(c==-1){b.addClass("active")}}},_addWidget:function(a,b){}});Blog.Entry.Preview=WCF.Popover.extend({_proxy:null,init:function(){this._super(".blogEntryLink");this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false});WCF.DOMNodeInsertedHandler.addCallback("Blog.Entry.Preview",$.proxy(this._initContainers,this))},_loadContent:function(){var b=$("#"+this._activeElementID);this._proxy.setOption("data",{actionName:"getEntryPreview",className:"blog\\data\\entry\\EntryAction",objectIDs:[b.data("entryID")]});var c=this._activeElementID;var a=this;this._proxy.setOption("success",function(e,f,d){a._insertContent(c,e.returnValues.template,true)});this._proxy.sendRequest()}});Blog.Entry.QuoteHandler=WCF.Message.Quote.Handler.extend({init:function(a){this._super(a,"blog\\data\\entry\\EntryAction","com.woltlab.blog.entry",".message",".messageBody",".messageBody > div > div.messageText")}});