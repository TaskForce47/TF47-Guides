var WBB={};WBB.Board={};WBB.Board.Collapsible=WCF.Collapsible.Remote.extend({_getContainers:function(){return $(".wbbBoardList .wbbCollapsibleCategory")},_getTarget:function(a){return this._containers[a].children("ul").first()},_getButtonContainer:function(a){return this._containers[a].find("header h2").first()},_getObjectID:function(a){return this._containers[a].data("boardID")},_updateContent:function(a,b,c){var d=$(b).attr("id",a);this._containers[a].replaceWith(d);this._containers[a]=d;this._initContainer(a,d)},_getAdditionalParameters:function(a){return{depth:this._containers[a].data("depth")}},});WBB.Board.MarkAllAsRead=Class.extend({_callback:null,_proxy:null,init:function(a){this._callback=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(){this._proxy.setOption("data",{actionName:"markAllAsRead",className:"wbb\\data\\board\\BoardAction"});this._proxy.sendRequest()},_success:function(c,d,b){if(this._callback&&$.isFunction(this._callback)){return this._callback()}var a=$(".wbbBoardList");a.find(".new").removeClass("new");a.find(".badge.badgeUpdate").hide();$("#mainMenu .active .badge").hide();a.find(".wbbBoard .icon32.markAsRead.icon-folder-close").removeClass("icon-folder-close").addClass("icon-folder-close-alt");a.find(".wbbSubBoards .icon16.markAsRead.icon-folder-close").removeClass("icon-folder-close").addClass("icon-folder-close-alt");a.find(".markAsRead").removeClass("markAsRead").unbind("dblclick")}});WBB.Board.MarkAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(document).on("dblclick",".wbbBoardList .markAsRead",$.proxy(this._dblClick,this))},_dblClick:function(a){this._proxy.setOption("data",{actionName:"markAsRead",className:"wbb\\data\\board\\BoardAction",objectIDs:[$(a.currentTarget).parents("li:eq(0)").data("boardID")]});this._proxy.sendRequest()},_success:function(c,d,b){var a=this;$(".wbbBoardList .markAsRead").each(function(g,h){var f=$(h);var e=f.parents("li:eq(0)");if(WCF.inArray(e.data("boardID"),c.objectIDs)){a._markAsRead(e,f)}})},_markAsRead:function(c,b){console.debug("Processing "+c.data("boardID"));c.removeClass("new").find(".new:eq(0)").removeClass("new");b.removeClass("markAsRead");c.find(".badge:eq(0)").hide();if(b.hasClass("icon-folder-close")){b.removeClass("icon-folder-close").addClass("icon-folder-close-alt")}b.unbind("dblclick");var a=this;c.find("ul:eq(0)").children("li").each(function(f,e){var d=$(e);a._markAsRead(d,d.find(".markAsRead:eq(0)"))})}});WBB.Board.MarkAllThreadsAsRead=Class.extend({_boardID:0,_proxy:null,init:function(a){this._boardID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".markAsReadButton").click($.proxy(this._click,this))},_click:function(a){this._proxy.setOption("data",{actionName:"markAsRead",className:"wbb\\data\\board\\BoardAction",objectIDs:[this._boardID]});this._proxy.sendRequest()},_success:function(b,c,a){$(".wbbThreadList .new").each(function(e,f){var d=$(f);d.removeClass("new");d.find(".firstNewPost").parent().remove();d.find(".columnAvatar").off("dblclick")})}});WBB.Board.IgnoreBoards=Class.extend({_dialog:null,_didInit:false,_proxy:null,init:function(){$(".ignoreBoardsButton").click($.proxy(this._click,this))},_click:function(a){if(!this._didInit){this._dialog=$("<div />").hide().appendTo(document.body);this._proxy=new WCF.Action.Proxy({autoSend:true,data:{actionName:"loadIgnoredBoards",className:"wbb\\data\\board\\BoardAction"},success:$.proxy(this._success,this)});this._didInit=true}else{this._dialog.wcfDialog("open")}},_initBoardList:function(){this._dialog.find("input[type=submit]").click($.proxy(this._submit,this));this._dialog.find("input[type=checkbox]").click($.proxy(this._checkboxClick,this));this._dialog.find("input[type=checkbox]:not(:checked)").each(function(a,c){var b=$(c);b.parents("li:eq(0)").find("ul input[type=checkbox]").each(function(){var d=$(this);if(d.data("ignorable")){d.prop("checked",b.prop("checked")).disable()}})})},_checkboxClick:function(b){var a=$(b.currentTarget);if(!a.prop("checked")){a.parents("li:eq(0)").find("ul input[type=checkbox]").each(function(){var c=$(this);if(c.data("ignorable")){c.prop("checked",a.prop("checked")).disable()}})}else{a.parents("li:eq(0)").find("ul input[type=checkbox]").each(function(){var c=$(this);if(c.data("ignorable")){c.enable()}})}},_submit:function(){var a=[];this._dialog.find("input[type=checkbox]:not(:checked)").each(function(){a.push($(this).val())});this._dialog.find("input[type=submit]").disable();this._proxy.setOption("data",{actionName:"saveIgnoredBoards",className:"wbb\\data\\board\\BoardAction",objectIDs:a});this._proxy.sendRequest()},_success:function(b,c,a){if(b.actionName==="loadIgnoredBoards"){this._dialog.html(b.returnValues.template);this._initBoardList();this._dialog.wcfDialog({title:WCF.Language.get("wbb.index.ignoreBoards")})}else{this._dialog.wcfDialog("close");this._dialog.find("input[type=submit]").enable();$(".wbbBoardList:eq(0)").html(b.returnValues.template)}}});WBB.Thread={};WBB.Thread.MarkAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(document).on("dblclick",".wbbThreadList .new .columnAvatar",$.proxy(this._dblclick,this))},_dblclick:function(a){this._proxy.setOption("data",{actionName:"markAsRead",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[$(a.currentTarget).parents("tr:eq(0)").data("threadID")]});this._proxy.sendRequest()},_success:function(b,c,a){$(".wbbThreadList .new").each(function(e,f){var d=$(f);if(WCF.inArray(d.data("threadID"),b.objectIDs)){d.removeClass("new");d.find(".firstNewPost").parent().remove();d.find(".columnAvatar").off("dblclick")}})}});WBB.Thread.Editor={_callbacks:[],_dialog:null,_dialogContainer:null,_environment:"",_notification:null,_proxy:null,_threadID:0,beginEdit:function(a,b){this._environment=a;this._threadID=b;if(this._proxy===null){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)})}this._proxy.setOption("data",{actionName:"beginEdit",className:"wbb\\data\\thread\\ThreadAction",parameters:{data:{threadID:this._threadID}}});this._proxy.sendRequest()},registerCallback:function(a){this._callbacks.push(a)},_success:function(b,c,a){switch(b.returnValues.actionName){case"beginEdit":this._showEditor(b);break;case"saveEdit":this._saveEdit(b);break}},_showEditor:function(e){if(this._dialog===null){this._dialogContainer=$('<div id="threadEditor" />').data("wbbThreadEditor",this).appendTo(document.body);this._dialog=$("<div />").appendTo(this._dialogContainer);var b=$('<div class="formSubmit" />').appendTo(this._dialogContainer);var d=$('<button class="buttonPrimary">'+WCF.Language.get("wcf.global.button.save")+"</button>").appendTo(b);var a=$("<button>"+WCF.Language.get("wcf.global.button.cancel")+"</button>").appendTo(b);a.click($.proxy(this._cancel,this));d.click($.proxy(this._save,this))}this._dialogContainer.data("threadID",e.returnValues.threadID);this._dialog.html(e.returnValues.template);var c=this;this._dialog.find("input").keyup(function(f){if(f.which===13){c._save();f.preventDefault();return false}});this._dialogContainer.wcfDialog({title:WCF.Language.get("wbb.thread.edit")});this._dialogContainer.wcfDialog("render")},_save:function(){var b={};var a=this._dialog.find("fieldset");if(!a.length){return}a.each($.proxy(function(g,e){var h=$(e);var f=h.attr("id").replace(/^threadEditor/,"").toLowerCase();b[f]=this._getValues(h)},this));for(var d=0,c=this._callbacks.length;d<c;d++){b=this._callbacks[d].getValues(this._dialog,b)}if($.getLength(b)){this._proxy.setOption("data",{actionName:"saveEdit",className:"wbb\\data\\thread\\ThreadAction",parameters:{data:{values:b,threadID:this._threadID}}});this._proxy.sendRequest()}},_saveEdit:function(a){if(a.returnValues.errors&&$.getLength(a.returnValues.errors)){this._dialog.find("small.innerError").remove();for(var c=0,b=this._callbacks.length;c<b;c++){this._callbacks[c].showErrors(a.returnValues.errors)}return}if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"))}if(a.returnValues.forceReload){this._notification.show(function(){window.location.reload()},undefined,WCF.Language.get("wcf.global.success.edit"))}else{for(var c in this._callbacks){this._callbacks[c].saved(this._environment,this._threadID,a)}this._dialogContainer.wcfDialog("close");this._notification.show()}},_getValues:function(a){var b={};a.find("input:not([type=radio])").each(function(d,c){var e=$(c);if(e.attr("type")==="checkbox"){b[e.attr("id")]=(e.prop("checked")?1:0)}else{b[e.attr("id")]=e.val()}});a.find("input[type=radio]:checked").each(function(d,c){var e=$(c);b[e.attr("name")]=e.val()});a.find("select").each(function(e,c){var d=$(c);b[d.attr("id")]=d.val()});return b},_cancel:function(){this._dialogContainer.wcfDialog("close")}};WBB.Thread.Editor.Default=Class.extend({init:function(){$("#threadEditor").data("wbbThreadEditor").registerCallback(this)},getValues:function(b,a){return a},saved:function(a,c,b){if(b.returnValues["default"]===undefined){return}if(a==="board"){$("#thread"+c+" > td.columnSubject > h3 > a").text(b.returnValues["default"].topic)}else{$("header.wbbThread[data-thread-id="+c+"] > h1 > a").text(b.returnValues["default"].topic);$("#post"+b.returnValues["default"].firstPostID+" .messageHeader > .messageHeadline > h1").text(b.returnValues["default"].topic)}},showErrors:function(a){if(a["default"]){for($fieldName in a["default"]){$('<small class="innerError">'+a["default"][$fieldName]+"</small>").insertAfter($("#threadEditorDefault #"+$fieldName))}}}});WBB.Thread.Editor.LabelChooser=WCF.Label.Chooser.extend({init:function(c,a,b,d){this._super(c,a,b,d);$("#threadEditor").data("wbbThreadEditor").registerCallback(this)},getValues:function(c,b){b.label={};for(var a in this._groups){var d=this._groups[a];if(d.data("labelID")!==undefined){b.label[a]=d.data("labelID")}}return b},saved:function(d,i,e){if(e.returnValues.label===undefined){return}var b=e.returnValues.label.labels;var f=$.getLength(b);var j=null;if(d==="board"){var k=$("#thread"+i+" > td.columnSubject");j=k.children(".labelList");if(j.length){if(f){j.empty()}else{j.remove()}}else{if($.getLength(b)){j=$('<ul class="labelList" />').prependTo(k)}}for(var c in b){var h=b[c];var g=$('<li><a href="'+h.link+'" class="badge label '+h.cssClassName+'">'+h.label+"</a></li>").appendTo(j);g.before(" ")}}else{var a=$("header.wbbThread[data-thread-id="+i+"]");j=a.children(".labelList");if(j.length){if(f){j.empty()}else{j.remove()}}else{if($.getLength(b)){j=$('<ul class="labelList" />').appendTo(a)}}for(var c in b){var h=b[c];var g=$('<li><span class="badge label '+h.cssClassName+'">'+h.label+"</span></li>").appendTo(j);g.after(" ")}}},showErrors:function(a){if(a.label){for($fieldName in a.label){$('<small class="innerError">'+a.label[$fieldName]+"</small>").insertAfter($("#threadEditorLabel .labelList"))}}}});WBB.Thread.InlineEditor=WCF.InlineEditor.extend({_boardID:0,_environment:"thread",_permissions:{},_redirectURL:"",_updateHandler:null,_setOptions:function(){this._boardID=0;this._environment="thread";this._options=[{label:WCF.Language.get("wbb.thread.edit.done"),optionName:"done"},{label:WCF.Language.get("wbb.thread.edit.undone"),optionName:"undone"},{label:WCF.Language.get("wbb.thread.edit.close"),optionName:"close"},{label:WCF.Language.get("wbb.thread.edit.open"),optionName:"open"},{label:WCF.Language.get("wbb.thread.edit.sticky"),optionName:"sticky"},{label:WCF.Language.get("wbb.thread.edit.scrape"),optionName:"scrape"},{label:WCF.Language.get("wbb.thread.edit.enable"),optionName:"enable"},{label:WCF.Language.get("wbb.thread.edit.disable"),optionName:"disable"},{label:WCF.Language.get("wbb.thread.edit.move"),optionName:"move"},{label:WCF.Language.get("wbb.thread.edit.removeLink"),optionName:"removeLink"},{label:WCF.Language.get("wbb.thread.edit.trash"),optionName:"trash"},{label:WCF.Language.get("wbb.thread.edit.restore"),optionName:"restore"},{label:WCF.Language.get("wbb.thread.edit.delete"),optionName:"delete"},{optionName:"divider"},{label:WCF.Language.get("wbb.thread.edit.advanced"),optionName:"advanced",isQuickOption:true}]},setUpdateHandler:function(a){this._updateHandler=a},_getTriggerElement:function(a){return a.find(".jsThreadInlineEditor")},_validate:function(a,b){var c=$("#"+a).data("threadID");if(this._updateHandler.getValue(c,"isLink")){if(b==="removeLink"&&this._getPermission("canMoveThread")){return true}return false}switch(b){case"close":case"open":if(!this._getPermission("canCloseThread")){return false}if(b==="open"){return(this._updateHandler.getValue(c,"isClosed"))}else{return !(this._updateHandler.getValue(c,"isClosed"))}break;case"delete":if(!this._getPermission("canDeleteThreadCompletely")){return false}return(this._updateHandler.getValue(c,"isDeleted"));break;case"done":case"undone":if(!this._updateHandler.getValue(c,"canMarkAsDone")){return false}if(b==="undone"){return(this._updateHandler.getValue(c,"isDone"))}else{return !(this._updateHandler.getValue(c,"isDone"))}break;case"restore":if(!this._getPermission("canRestoreThread")){return false}return(this._updateHandler.getValue(c,"isDeleted"));break;case"trash":if(!this._getPermission("canDeleteThread")){return false}return !(this._updateHandler.getValue(c,"isDeleted"));break;case"sticky":case"scrape":if(!this._getPermission("canPinThread")||(this._updateHandler.getValue(c,"isAnnouncement"))){return false}if(b==="scrape"){return(this._updateHandler.getValue(c,"isSticky"))}else{return !(this._updateHandler.getValue(c,"isSticky"))}break;case"enable":if(!this._getPermission("canEnableThread")){return false}if(this._updateHandler.getValue(c,"isDeleted")){return false}return(this._updateHandler.getValue(c,"isDisabled"));break;case"disable":if(!this._getPermission("canEnableThread")){return false}if(this._updateHandler.getValue(c,"isDeleted")){return false}return !(this._updateHandler.getValue(c,"isDisabled"));break;case"move":return this._getPermission("canMoveThread");break;case"advanced":return true;break}return false},_execute:function(a,d){if(!this._validate(a,d)){return false}switch(d){case"close":case"open":var g=(d==="open")?0:1;this._updateThread(a,d,{isClosed:g});break;case"sticky":case"scrape":var c=(d==="scrape")?0:1;this._updateThread(a,d,{isSticky:c});break;case"done":case"undone":var e=(d==="done")?1:0;this._updateThread(a,d,{isDone:e});break;case"enable":case"disable":this._updateThread(a,d,{isDisabled:(d==="enable"?0:1)});break;case"move":var f=this._elements[a].data("threadID");WBB.Thread.MoveHandler.prepare([f],$.proxy(function(h){this._updateHandler.update(f,h.returnValues.threadData[f])},this),this._boardID,this._environment);break;case"removeLink":this._updateThread(a,d,{removeLink:1});break;case"delete":var b=this;WCF.System.Confirmation.show(WCF.Language.get("wbb.thread.confirmDelete"),function(h){if(h==="confirm"){b._updateThread(a,d,{deleted:1})}});break;case"restore":this._updateThread(a,d,{isDeleted:0});break;case"trash":var b=this;WCF.System.Confirmation.show(WCF.Language.get("wbb.thread.confirmTrash"),function(h){if(h==="confirm"){b._updateThread(a,d,{isDeleted:1,reason:$("#wcfSystemConfirmationContent").find("textarea").val()})}},{},$("<fieldset><dl><dt>"+WCF.Language.get("wbb.thread.confirmTrash.reason")+'</dt><dd><textarea cols="40" rows="4" /></dd></dl></fieldset>'));break;case"advanced":WBB.Thread.Editor.beginEdit(this._environment,this._elements[a].data("threadID"));break;default:return false;break}return true},_updateThread:function(a,c,e){if(c==="delete"||c==="removeLink"){var b=this;var d=this._elements[a].data("threadID");new WCF.Action.Proxy({autoSend:true,data:{actionName:c,className:"wbb\\data\\thread\\ThreadAction",objectIDs:[d]},success:function(f){b._updateHandler.update(d,f.returnValues.threadData[d])}})}else{this._updateData.push({data:e,elementID:a,optionName:c});this._proxy.setOption("data",{actionName:c,className:"wbb\\data\\thread\\ThreadAction",objectIDs:[this._elements[a].data("threadID")],parameters:{data:e}});this._proxy.sendRequest()}},_updateState:function(){this._notification.show();for(var d=0,c=this._updateData.length;d<c;d++){var a=this._updateData[d];if((a.data.isSticky!==undefined)&&this._redirectURL){window.location=this._redirectURL;return}var b=$("#"+a.elementID).data("threadID");this._updateHandler.update(b,a.data)}},_getPermission:function(a){if(this._permissions[a]){return this._permissions[a]}return 0},setEnvironment:function(a,c,b){if(a!=="board"){a="thread"}this._boardID=(c)?c:0;this._environment=a;this._redirectURL=b},setPermission:function(a,b){this._permissions[a]=b},setPermissions:function(a){for(var b in a){this.setPermission(b,a[b])}}});WBB.Thread.QuickReply=WCF.Message.QuickReply.extend({init:function(a){this._super(true,a);this._successMessageNonVisible="wbb.post.moderation.redirect"},_getClassName:function(){return"wbb\\data\\post\\PostAction"},_getObjectID:function(){return this._container.data("threadID")}});WBB.Thread.Clipboard=Class.extend({_boardID:0,_environment:"board",_updateHandler:null,init:function(updateHandler,environment,boardID){this._updateHandler=updateHandler;this._environment=environment;this._boardID=(boardID)?boardID:0;$(".jsClipboardEditor").each($.proxy(function(index,container){var $container=$(container);var $types=eval($container.data("types"));if(WCF.inArray("com.woltlab.wbb.thread",$types)){$container.on("clipboardAction",$.proxy(this._execute,this));$container.on("clipboardActionResponse",$.proxy(this._evaluateResponse,this));return false}},this))},_execute:function(e,c,a,d){if(c!=="com.woltlab.wbb.thread"){return}switch(a){case"com.woltlab.wbb.thread.merge":var b=new WBB.Thread.MergeHandler(d.objectIDs);b.load();break;case"com.woltlab.wbb.thread.move":WBB.Thread.MoveHandler.prepare(d.objectIDs,$.proxy(this._move,this),this._boardID,this._environment);break}},_move:function(a){this._evaluateResponse(null,a,"com.woltlab.wbb.thread","com.woltlab.wbb.thread.move",null)},_evaluateResponse:function(d,f,b,a,c){if(b!=="com.woltlab.wbb.thread"){return}if(!f.returnValues.threadData||!$.getLength(f.returnValues.threadData)){return}for(var e in f.returnValues.threadData){this._updateHandler.update(e,f.returnValues.threadData[e],false)}WCF.Clipboard.reload()}});WBB.Thread.UpdateHandler=Class.extend({_markAsDoneHandler:null,_threads:{},init:function(){var a=this;$(".wbbThread").each(function(d,b){var c=$(b);a._threads[c.data("threadID")]=c})},setMarkAsDoneHandler:function(a){this._markAsDoneHandler=a},update:function(d,c,b){if(c.moved){window.location.reload();return}if(!this._threads[d]){console.debug("[WBB.Thread.UpdateHandler] Unknown thread id "+d);return}for(var a in c){this._updateProperty(d,a,c[a])}if(b!==false){WCF.Clipboard.reload()}},_updateProperty:function(c,b,a){switch(b){case"deleted":this._delete(c,a);break;case"deleteNote":this._deleteNote(c,a);break;case"isClosed":if(a){this._close(c)}else{this._open(c)}break;case"isDeleted":if(a){this._trash(c)}else{this._restore(c)}break;case"isDisabled":if(a){this._disable(c)}else{this._enable(c)}break;case"isDone":if(a){this._done(c)}else{this._undone(c)}break;case"isSticky":if(a){this._sticky(c)}else{this._scrape(c)}break;case"moved":this._moved(c);break;case"showMoveNotice":this._showMoveNotice(c);break;case"title":this._updateTitle(c,a);break;default:this._handleCustomProperty(c,b,a);break}},_handleCustomProperty:function(c,b,a){this._threads[c].trigger("threadUpdateHandlerProperty",[c,b,a])},_close:function(a){this._threads[a].data("isClosed",1)},_delete:function(b,a){},_deleteNote:function(b,a){},_disable:function(a){this._threads[a].data("isDisabled",1)},_done:function(a){this._threads[a].data("isDone",1)},_enable:function(a){this._threads[a].data("isDisabled",0)},_moved:function(a){},_open:function(a){this._threads[a].data("isClosed",0)},_restore:function(a){this._threads[a].data("isDeleted",0)},_scrape:function(a){this._threads[a].data("isSticky",0)},_sticky:function(a){this._threads[a].data("isSticky",1)},_trash:function(a){this._threads[a].data("isDeleted",1)},_undone:function(a){this._threads[a].data("isDone",0)},_updateTitle:function(b,a){},_getCloseIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.closed")+'" class="icon icon16 icon-lock jsTooltip jsIconClosed" /></li>')},_getDoneIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.done")+'" class="icon icon16 icon-check jsTooltip jsIconDone wbbMarkAsDone" /></li>')},_getMoveIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.moved")+'" class="icon icon16 icon-arrow-right jsTooltip jsIconMoved" /></li>')},_getUndoneIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.undone")+'" class="icon icon16 icon-check-empty jsTooltip jsIconUndone wbbMarkAsDone" /></li>')},getValue:function(b,a){if(!this._threads[b]){console.debug("[WBB.Thread.UpdateHandler] Unknown thread id "+b);return}switch(a){case"isAnnouncement":return this._threads[b].data("isAnnouncement");break;case"isClosed":return this._threads[b].data("isClosed");break;case"isDeleted":return this._threads[b].data("isDeleted");break;case"isDisabled":return this._threads[b].data("isDisabled");break;case"isDone":return this._threads[b].data("isDone");break;case"isSticky":return this._threads[b].data("isSticky");break;case"isLink":return this._threads[b].data("isLink");break;case"canMarkAsDone":return this._threads[b].data("canMarkAsDone");break}}});WBB.Thread.UpdateHandler.Board=WBB.Thread.UpdateHandler.extend({_close:function(a){this._super(a);this._getCloseIcon().appendTo(this._threads[a].find(".statusIcons"))},_delete:function(b,a){this._threads[b].remove();delete this._threads[b];WCF.Clipboard.reload()},_deleteNote:function(b,a){$('<small class="wbbThreadDeleteNote">'+a+"</small>").appendTo(this._threads[b].find(".columnSubject"))},_disable:function(a){this._super(a);this._threads[a].addClass("messageDisabled")},_done:function(c){this._super(c);var b=this._threads[c].find(".jsIconUndone").parent();var a=this._getDoneIcon();a.insertAfter(b);b.remove();if(this._markAsDoneHandler!==null){this._markAsDoneHandler.watch(c)}},_enable:function(a){this._super(a);this._threads[a].removeClass("messageDisabled")},_moved:function(a){window.location.reload()},_showMoveNotice:function(a){this._getMoveIcon().appendTo(this._threads[a].find(".statusIcons"))},_open:function(a){this._super(a);this._threads[a].find(".jsIconClosed").parent().remove()},_scrape:function(a){this._super(a)},_sticky:function(a){this._super(a)},_restore:function(a){this._super(a);this._threads[a].removeClass("messageDeleted");this._threads[a].find(".columnSubject > .wbbThreadDeleteNote").remove()},_trash:function(a){this._super(a);this._threads[a].addClass("messageDeleted")},_undone:function(c){this._super(c);var b=this._threads[c].find(".jsIconDone").parent();var a=this._getUndoneIcon();a.insertAfter(b);b.remove();if(this._markAsDoneHandler!==null){this._markAsDoneHandler.watch(c)}}});WBB.Thread.UpdateHandler.Thread=WBB.Thread.UpdateHandler.extend({_boardID:0,_postHandler:null,init:function(a){this._boardID=a;this._super()},setPostHandler:function(a){this._postHandler=a},update:function(b,a){if(this._threads[b]){if(a.isDeleted!==undefined&&!a.isDeleted&&a.ignoreDeletedPosts!==undefined){this._restore(b,true);delete a.isDeleted;delete a.ignoreDeletedPosts}if(a.isDisabled!==undefined&&!a.isDisabled&&a.ignoreDisabledPosts!==undefined){this._enable(b,true);delete a.isDisabled;delete a.ignoreDisabledPosts}}this._super(b,a)},_close:function(b){this._super(b);var a=this._getCloseIcon();a.appendTo(this._threads[b].find("h1 + ul.statusIcons"))},_delete:function(b,a){new WCF.PeriodicalExecuter(function(c){c.stop();window.location=a},1000)},_disable:function(a){this._super(a);this._postHandler.updateAllPosts("isDisabled",1)},_done:function(c){this._super(c);var b=this._threads[c].find("h1 + ul.statusIcons span.jsIconUndone").parent();var a=this._getDoneIcon();a.insertAfter(b);b.remove();if(this._markAsDoneHandler!==null){this._markAsDoneHandler.watch(c)}},_enable:function(b,a){this._super(b);if(!a){this._postHandler.updateAllPosts("isDisabled",0)}},_moved:function(a){window.location.reload()},_showMoveNotice:function(a){window.location.reload()},_open:function(a){this._super(a);this._threads[a].find("h1 + ul.statusIcons span.jsIconClosed").parent().remove()},_scrape:function(a){this._super(a);this._threads[a].find("h1 > span.jsSticky").remove()},_sticky:function(b){this._super(b);var a=$('<span class="badge label jsSticky">'+WCF.Language.get("wbb.thread.sticky")+"</span>").prependTo(this._threads[b].find("h1"));a.after(" ")},_restore:function(b,a){this._super(b);if(!a){this._postHandler.updateAllPosts("isDeleted",0)}},_trash:function(a){this._super(a);this._postHandler.updateAllPosts("isDeleted",1)},_undone:function(c){this._super(c);var b=this._threads[c].find("h1 + ul.statusIcons span.jsIconDone").parent();var a=this._getUndoneIcon();a.insertAfter(b);b.remove();if(this._markAsDoneHandler!==null){this._markAsDoneHandler.watch(c)}}});WBB.Thread.MergeHandler=Class.extend({_className:"",_dialog:null,_dialogTitle:"",_objectIDs:[],_proxy:null,_successMessage:"",init:function(a){this._className="wbb\\data\\thread\\ThreadAction";this._dialogTitle=WCF.Language.get("wbb.thread.edit.merge");this._objectIDs=a;this._successMessage=WCF.Language.get("wbb.thread.edit.merge.success");this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)})},load:function(){this._proxy.setOption("data",{actionName:"prepareMerge",className:this._className,objectIDs:this._objectIDs});this._proxy.sendRequest()},_success:function(c,e,a){if(c.returnValues.redirectURL){var d=new WCF.System.Notification(this._successMessage);d.show(function(){window.location=c.returnValues.redirectURL});return}if(this._dialog===null){this._dialog=$("<div />").hide().appendTo(document.body);this._dialog.html(c.returnValues.template);this._dialog.wcfDialog({title:this._dialogTitle})}else{this._dialog.html(c.returnValues.template);this._dialog.wcfDialog("show")}var b=this._dialog.find(".formSubmit > button[data-type=submit]").disable().click($.proxy(this._submit,this));this._dialog.find("input[type=radio]").change(function(){b.enable()})},_submit:function(){this._dialog.find(".formSubmit > button[data-type=submit]").disable();this._proxy.setOption("data",{actionName:"merge",className:this._className,objectIDs:this._objectIDs,parameters:this._getParameters()});this._proxy.sendRequest()},_getParameters:function(){return{threadID:this._dialog.find("input[type=radio]:checked").val()}}});WBB.Thread.MoveHandler={_boardID:0,_callback:null,_dialog:null,_didInit:false,_environment:"",_proxy:null,_threadIDs:[],_init:function(){this._dialog=$("<div />").hide().appendTo(document.body);this._proxy=new WCF.Action.Proxy();this._didInit=true},prepare:function(b,d,c,a){if(!$.isFunction(d)){console.debug("[WBB.Thread.MoveHandler] Given callback is invalid.");return}this._callback=d;this._boardID=c||0;this._threadIDs=b;this._environment=a;if(!this._didInit){this._init()}this._proxy.setOption("data",{actionName:"prepareMove",className:"wbb\\data\\thread\\ThreadAction",objectIDs:this._threadIDs,parameters:{boardID:this._boardID}});this._proxy.setOption("success",$.proxy(this._success,this));this._proxy.sendRequest()},_success:function(b,c,a){this._dialog.data("objectIDs",b.objectIDs).html(b.returnValues.template);this._dialog.wcfDialog({title:WCF.Language.get("wbb.thread.edit.moveThreads")});this._dialog.find(".formSubmit > input[type=submit]").click($.proxy(this._move,this))},_move:function(b){var c=this._dialog.find("#showMoveNotice").prop("checked");var a=parseInt(this._dialog.find("#boardID").prop("value"));if(a){if(a==this._boardID&&this._threadIDs.length==1&&this._environment==="thread"){this._dialog.find("#boardID").next("small.innerError").remove();$('<small class="innerError">'+WCF.Language.get("wbb.thread.edit.moveDestination.error.equalsOrigin")+"</small>").insertAfter(this._dialog.find("#boardID"));return}this._proxy.setOption("data",{actionName:"move",className:"wbb\\data\\thread\\ThreadAction",objectIDs:this._dialog.data("objectIDs"),parameters:{boardID:a,showMoveNotice:c}});this._proxy.setOption("success",$.proxy(function(d){this._callback(d)},this));this._proxy.sendRequest()}this._dialog.wcfDialog("close")},};WBB.Thread.TypeChooser=Class.extend({_boardIDsContainer:null,_type:0,init:function(c){this._type=parseInt(c);this._boardIDsContainer=$("#boardIDsContainer");var a=$("input[name=type]").click($.proxy(this._click,this));var b=this;a.each(function(e,f){var d=$(f);if(d.prop("value")==b._type){d.prop("checked","checked");b._update();return false}})},_click:function(a){this._type=parseInt($(a.currentTarget).prop("value"));this._update()},_update:function(){switch(this._type){case 0:case 1:this._boardIDsContainer.hide();break;case 2:this._boardIDsContainer.show();break}}});WBB.Thread.LastPageHandler=Class.extend({_action:"",_isLoading:false,_lastPostTime:0,_pageNo:0,_proxy:null,_threadID:0,init:function(c,b,a){this._isLoading=false;this._lastPostTime=b;this._pageNo=a;this._threadID=c;this._action="";this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false,success:$.proxy(this._success,this),suppressErrors:true});new WCF.Action.Scroll(300,$.proxy(this._scroll,this),window,".wbbThreadPostList")},_scroll:function(a){a.stop();this._action="getNewPosts";this._proxy.setOption("data",{actionName:"getNewPosts",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[this._threadID],parameters:{countPosts:true,lastPostTime:this._lastPostTime}});this._proxy.sendRequest()},_success:function(d,e,c){if(this._action==="getNewPosts"){if(d.returnValues.newPostsCount>0){var b=WCF.Language.get("wbb.thread.newPosts",{newPostsCount:d.returnValues.newPostsCount});var a=$('<p id="wbbNewPostsLink" class="info pointer">'+b+"</p>").insertAfter($(".wbbThreadPostList"));a.click($.proxy(this._click,this))}}else{if(d.returnValues.redirectURL){window.location=d.returnValues.redirectURL}else{$("#wbbNewPostsLink").remove();$(d.returnValues.template).insertBefore($("#messageQuickReply"));if(d.returnValues.nextPageNotice){$('<p class="info">'+d.returnValues.nextPageNotice+"</p>").insertAfter($(".wbbThreadPostList"))}$("#messageQuickReply").data("lastPostTime",d.returnValues.lastPostTime)}}},_click:function(a){if(this._isLoading){return false}else{$(a.currentTarget).removeClass("pointer");this._isLoading=true}this._action="loadPosts";this._proxy.setOption("data",{actionName:"getNewPosts",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[this._threadID],parameters:{countPosts:false,lastPostTime:this._lastPostTime,pageNo:this._pageNo}});this._proxy.sendRequest()}});WBB.Thread.MarkAsDone=Class.extend({_proxy:null,_updateHandler:null,_threads:{},init:function(b){this._updateHandler=b;this._threads={};this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});var a=this;$(".wbbThread").each(function(e,c){var d=$(c);var f=d.data("threadID");a._threads[f]=d;if(d.data("canMarkAsDone")){a.watch(f)}});this._updateHandler.setMarkAsDoneHandler(this)},watch:function(a){if(this._threads[a]&&this._threads[a].data("canMarkAsDone")){this._threads[a].find(".jsIconDone, .jsIconUndone").data("threadID",a).dblclick($.proxy(this._dblclick,this))}},_dblclick:function(c){var a=$(c.currentTarget);var b=(a.hasClass("jsIconDone")?true:false);this._proxy.setOption("data",{actionName:(b?"un":"")+"done",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[a.data("threadID")]});this._proxy.sendRequest()},_success:function(c,d,a){for(var b in c.returnValues.threadData){this._updateHandler.update(b,c.returnValues.threadData[b])}}});WBB.Thread.SimilarThreads=Class.extend({_proxy:null,_element:null,_boardID:0,init:function(a,b){this._element=a;this._boardID=b;this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false,success:$.proxy(this._success,this)});a.on("blur",$.proxy(this._load,this))},_load:function(d){var e=$(d.currentTarget);var c=e.val();var a=null;if(c!=""&&c.length>3){var b=$("#languageIDContainer > input[name=languageID]");if(b.length){a=b.val()}this._proxy.setOption("data",{actionName:"getSimilarThreads",className:"wbb\\data\\thread\\ThreadAction",parameters:{topic:c,boardID:this._boardID,languageID:a}});this._proxy.sendRequest()}else{this._element.parent().find(".wbbInlineSimilarThreadList").remove()}},_success:function(b,c,a){if(this._element.parent().find(".wbbInlineSimilarThreadList").length>0){this._element.parent().find(".wbbInlineSimilarThreadList").replaceWith(b.returnValues.template)}else{this._element.parent().append(b.returnValues.template)}}});WBB.Thread.WatchedThreadList=Class.extend({_button:null,_markAllCheckbox:null,init:function(){this._button=$("#stopWatchingButton").click($.proxy(this._stopWatching,this));this._markAllCheckbox=$(".jsMarkAllWatchedThreads").change($.proxy(this._markAll,this));$(".jsWatchedThread").change($.proxy(this._mark,this))},_mark:function(a){$(a.target).parents("tr").toggleClass("jsMarked");if(this._markAllCheckbox.is(":checked")){this._markAllCheckbox.prop("checked",false)}else{this._markAllCheckbox.prop("checked",$(".jsWatchedThread:not(:checked)").length==0)}this._updateButtonLabel()},_markAll:function(a){$(".jsWatchedThread").prop("checked",this._markAllCheckbox.prop("checked")).parents("tr").toggleClass("jsMarked",this._markAllCheckbox.prop("checked"));this._updateButtonLabel()},_stopWatching:function(c){var b=$(".jsWatchedThread:checked");var a=[];var d=false;if(b.length){b.each(function(f,g){a.push($(g).data("objectID"))})}else{d=true}var e="wbb.thread.watchedThreads.stopWatchingMarked.confirmMessage";if(d){e="wbb.thread.watchedThreads.stopWatchingAll.confirmMessage"}WCF.System.Confirmation.show(WCF.Language.get(e),function(f){if(f==="confirm"){new WCF.Action.Proxy({autoSend:true,data:{actionName:"stopWatching",className:"wbb\\data\\thread\\ThreadAction",parameters:{stopWatchingAll:d,threadIDs:a}},success:function(){window.location.reload()}})}})},_updateButtonLabel:function(){var a=$(".jsWatchedThread:checked");var b="";if(a.length){b=WCF.Language.get("wbb.thread.watchedThreads.stopWatchingMarked",{count:a.length})}else{b=WCF.Language.get("wbb.thread.watchedThreads.stopWatchingAll")}this._button.html(b)}});WBB.Post={};WBB.Post.Clipboard=Class.extend({_postHandler:null,_threadUpdateHandler:null,init:function(postHandler){this._postHandler=postHandler;$(".jsClipboardEditor").each($.proxy(function(index,container){var $container=$(container);var $types=eval($container.data("types"));if(WCF.inArray("com.woltlab.wbb.post",$types)){$container.on("clipboardAction",$.proxy(this._execute,this));$container.on("clipboardActionResponse",$.proxy(this._evaluateResponse,this));return false}},this))},setThreadUpdateHandler:function(a){this._threadUpdateHandler=a},_execute:function(e,c,a,d){if(c!=="com.woltlab.wbb.post"){return}switch(a){case"com.woltlab.wbb.post.merge":var b=new WBB.Post.MergeHandler(d.objectIDs);b.load();break;case"com.woltlab.wbb.post.moveToNewThread":WBB.Post.MoveToNewThread.prepare(d);break}},_evaluateResponse:function(d,f,b,a,c){if(b!=="com.woltlab.wbb.post"){return}if(a==="com.woltlab.wbb.post.moveToExistingThread"){var g=new WCF.System.Notification();g.show(function(){window.location=f.returnValues.redirectURL});return}if(f.returnValues.postData&&$.getLength(f.returnValues.postData)){this._postHandler.updatePosts(f)}if(this._threadUpdateHandler&&f.returnValues.threadData&&$.getLength(f.returnValues.threadData)){for(var e in f.returnValues.threadData){this._threadUpdateHandler.update(e,f.returnValues.threadData[e])}}}});WBB.Post.MergeHandler=WBB.Thread.MergeHandler.extend({init:function(a){this._super(a);this._className="wbb\\data\\post\\PostAction";this._dialogTitle=WCF.Language.get("wbb.post.edit.merge");this._successMessage=WCF.Language.get("wbb.post.edit.merge.success")},_success:function(b,c,a){this._super(b,c,a);if(b.returnValues.redirectURL===undefined){this._dialog.find(".formSubmit > button[data-type=submit]").enable()}},_getParameters:function(){var a=[];this._dialog.find(".jsPostContainer").each(function(c,b){a.push($(b).data("postID"))});return{postOrder:a}}});WBB.Post.MoveToNewThread={_boardSelect:null,_dialog:null,_objectIDs:[],_submitButton:null,_topic:null,prepare:function(a){if(this._dialog===null){this._dialog=$("<div>"+a.template+"</div>").hide().appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.moveToNewThread")})}else{this._dialog.html($.parseHTML(a.template)).wcfDialog("open")}this._boardSelect=$("#postMoveNewThreadBoardID");this._objectIDs=a.objectIDs;this._submitButton=this._dialog.find(".formSubmit > button[data-type=submit]").disable().click($.proxy(this._submit,this));this._topic=$("#postMoveNewThreadTopic").keyup($.proxy(this._keyUp,this)).focus();if($.browser.mozilla&&$.browser.touch){this._topic.on("input",$.proxy(this._keyUp,this))}},_keyUp:function(){if($.trim(this._topic.val()).length>0){this._submitButton.enable()}else{this._submitButton.disable()}},_submit:function(){this._submitButton.disable();new WCF.Action.Proxy({autoSend:true,data:{actionName:"moveToNewThread",className:"wbb\\data\\post\\PostAction",objectIDs:this._objectIDs,parameters:{boardID:parseInt(this._boardSelect.val()),topic:$.trim(this._topic.val())}},success:$.proxy(this._success,this)})},_success:function(b,d,a){var c=new WCF.System.Notification();c.show(function(){window.location=b.returnValues.redirectURL})}};WBB.Post.Preview=WCF.Popover.extend({_proxy:null,init:function(){this._super(".wbbTopicLink, .wbbPostLink");this._proxy=new WCF.Action.Proxy({showLoadingOverlay:false});WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.Preview",$.proxy(this._initContainers,this))},_loadContent:function(){var b=$("#"+this._activeElementID);if(b.hasClass("wbbTopicLink")){this._proxy.setOption("data",{actionName:"getPostPreview",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[b.data("threadID")],parameters:{sortOrder:(b.data("sortOrder")?b.data("sortOrder"):"ASC")}})}else{this._proxy.setOption("data",{actionName:"getPostPreview",className:"wbb\\data\\post\\PostAction",objectIDs:[b.data("postID")]})}var c=this._activeElementID;var a=this;this._proxy.setOption("success",function(e,f,d){a._insertContent(c,e.returnValues.template,true)});this._proxy.setOption("failure",function(e,d,g,f){a._insertContent(c,e.message,true);return false});this._proxy.sendRequest()}});WBB.Post.Handler=Class.extend({_callbacks:{},_editor:null,_collapsedPostLoader:null,_posts:{},_proxy:null,_selector:"",_threadUpdateHandler:null,init:function(a){this._callbacks={};this._editor=null;this._selector=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this.updatePosts,this)});this._initPosts();WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.Handler",$.proxy(this._initPosts,this))},setCollapsedPostLoader:function(a){this._collapsedPostLoader=a},setPostEditor:function(a){this._editor=a},setPost:function(a,b){this._posts[a]=b},setThreadUpdateHandler:function(a){this._threadUpdateHandler=a},_initPosts:function(){$(this._selector).each($.proxy(function(c,d){var a=$(d);var b=a.data("objectID");if(this._posts[b]===undefined){this.setPost(b,a)}},this))},updateAllPosts:function(c,b){var d={};for(var a in this._posts){d[a]={};d[a][c]=b}this.updatePosts({returnValues:{postData:d}})},updatePosts:function(b){var c=[];for(var a in b.returnValues.postData){if(this._posts[a]===undefined){continue}var g=this._posts[a];var h=b.returnValues.postData[a];for(var e in h){g.data(e,h[e]);if(e==="isDeleted"){if(h[e]){g.addClass("messageDeleted")}else{if(g.hasClass("wbbPostDeleted")){c.push(a)}g.removeClass("messageDeleted");g.find(".wbbPostDeleteNote").remove()}}else{if(e==="isDisabled"){if(h[e]){g.addClass("messageDisabled")}else{g.removeClass("messageDisabled")}}else{if(e==="deleted"){g.parent().remove()}else{if(e==="isClosed"){if(h[e]){g.find(".messageQuickOptions").prepend($('<li class="wbbPostClosed"><span class="jsTooltip icon icon16 icon-lock" title="'+WCF.Language.get("wbb.post.closed")+'"></span></li>'))}else{g.find(".wbbPostClosed").remove()}}}}}}if(this._callbacks[a]){for(var i=0,f=this._callbacks[a].length;i<f;i++){this._callbacks[a][i]()}delete this._callbacks[a]}}if(c.length&&this._collapsedPostLoader){this._collapsedPostLoader.loadPosts(c)}if(this._threadUpdateHandler&&b.returnValues.threadData){for(var d in b.returnValues.threadData){this._threadUpdateHandler.update(d,b.returnValues.threadData[d])}}if(this._editor!==null){this._editor.rebuild()}WCF.Clipboard.reload()},update:function(a,b,c,d){c=c||{};this._proxy.setOption("data",{actionName:b,className:"wbb\\data\\post\\PostAction",objectIDs:[a],parameters:c});this._proxy.sendRequest();if($.isFunction(d)){if(!this._callbacks[a]){this._callbacks[a]=[]}this._callbacks[a].push(d)}},getPost:function(a){if(this._posts[a]){return this._posts[a]}return null}});WBB.Post.Like=WCF.Like.extend({_getContainers:function(){return $("article.message:not(.messageCollapsed)")},_getObjectID:function(a){return this._containers[a].data("postID")},_getWidgetContainer:function(a){return this._containers[a].find(".messageHeader")},_buildWidget:function(b,a,e,d,f){var g=this._getWidgetContainer(b);if(this._canLike){var c=this._containers[b].find(".smallButtons");a.insertBefore(c.find(".toTopLink"));e.insertBefore(c.find(".toTopLink"));e.find("a").addClass("button");a.find("a").addClass("button")}if(f){f.appendTo(this._containers[b].find(".messageBody > .messageFooter"));f.addClass("messageFooterNote")}g.find(".permalink").after(d)},_setActiveState:function(a,b,c){a=a.find(".button").removeClass("active");b=b.find(".button").removeClass("active");if(c==1){a.addClass("active")}else{if(c==-1){b.addClass("active")}}},_addWidget:function(a,b){}});WBB.Post.InlineEditor=WCF.Message.InlineEditor.extend({_postHandler:null,init:function(a,b,c){this._super(a,true,c);this._postHandler=b;this._postHandler.setPostEditor(this)},_getClassName:function(){return"wbb\\data\\post\\PostAction"},_initDropdownMenu:function(j,f){var k=this._container[j];var b=k.data("objectID");if(k.data("canEnable")){var i=$('<li class="jsEnablePost"><span>'+WCF.Language.get("wbb.post.edit.enable")+"</span></li>").appendTo(f);i.data("postID",b).data("actionName","enable").click($.proxy(this._updatePost,this));var e=$('<li class="jsDisablePost"><span>'+WCF.Language.get("wbb.post.edit.disable")+"</span></li>").appendTo(f);e.data("postID",b).data("actionName","disable").click($.proxy(this._updatePost,this));if(k.data("isDisabled")||k.data("isDeleted")){e.hide()}if(!k.data("isDisabled")||k.data("isDeleted")){i.hide()}}if(k.data("canClose")){var d=$('<li class="jsClosePost"><span>'+WCF.Language.get("wbb.post.edit.close")+"</span></li>").appendTo(f);var h=$('<li class="jsOpenPost"><span>'+WCF.Language.get("wbb.post.edit.open")+"</span></li>").appendTo(f);d.data("postID",b).data("actionName","close").click($.proxy(this._updatePost,this));h.data("postID",b).data("actionName","open").click($.proxy(this._updatePost,this));if(k.data("isClosed")){d.hide()}else{h.hide()}}if(k.data("canDelete")){var g=$('<li class="jsDeletePost"><span>'+WCF.Language.get("wbb.post.edit.delete")+"</span></li>").appendTo(f);g.data("postID",b).data("actionName","trash").click($.proxy(this._updatePost,this));if(k.data("isDeleted")){g.hide()}}if(k.data("canRestore")){var c=$('<li class="jsRestorePost"><span>'+WCF.Language.get("wbb.post.edit.restore")+"</span></li>").appendTo(f);c.data("postID",b).data("actionName","restore").click($.proxy(this._updatePost,this));if(!k.data("isDeleted")){c.hide()}}if(k.data("canDeleteCompletely")){var a=$('<li class="jsDeletePostCompletely"><span>'+WCF.Language.get("wbb.post.edit.deleteCompletely")+"</span></li>").appendTo(f);a.data("postID",b).data("actionName","delete").click($.proxy(this._updatePost,this));if(!k.data("isDeleted")){a.hide()}}if(k.data("canEdit")){$('<li class="dropdownDivider" />').appendTo(f);$("<li><span>"+WCF.Language.get("wbb.post.edit")+"</span></li>").click($.proxy(function(){this._click(null,j)},this)).appendTo(f)}},_updatePost:function(c){var a=$(c.currentTarget);var d=this._postHandler.getPost(a.data("postID"));switch(a.data("actionName")){case"trash":var b=$("<fieldset><dl></dl></fieldset>");$('<dt><label for="postTrashReason">'+WCF.Language.get("wbb.post.edit.trash.reason")+"</label></dt>").appendTo(b.children("dl"));$('<dd><textarea id="postTrashReason" name="reason" cols="40" rows="3" /></dd>').appendTo(b.children("dl"));WCF.System.Confirmation.show(WCF.Language.get("wbb.post.edit.trash.confirmMessage"),$.proxy(function(e){if(e==="confirm"){this._postHandler.update(a.data("postID"),a.data("actionName"),{reason:$("#postTrashReason").val()},function(){new WCF.System.Notification().show()})}},this),"",b);break;case"delete":WCF.System.Confirmation.show(WCF.Language.get("wbb.post.edit.delete.confirmMessage"),$.proxy(function(e){if(e==="confirm"){this._postHandler.update(a.data("postID"),a.data("actionName"),undefined,function(){new WCF.System.Notification().show()})}},this));break;default:this._postHandler.update(a.data("postID"),a.data("actionName"),undefined,function(){new WCF.System.Notification().show()});break}},rebuild:function(){for(var c in this._container){var d=this._container[c];var b=d.data("objectID");if(this._dropdowns[b]===undefined){continue}var a=this._dropdowns[b];a.children(".jsEnablePost, .jsDisablePost, .jsClosePost, .jsOpenPost, .jsRestorePost, .jsDeletePostCompletely, .jsDeletePost").hide();if(d.data("canClose")){if(d.data("isClosed")){a.children(".jsOpenPost").show()}else{a.children(".jsClosePost").show()}}if(d.data("isDeleted")){if(d.data("canRestore")){a.children(".jsRestorePost").show()}if(d.data("canDeleteCompletely")){a.children(".jsDeletePostCompletely").show()}}else{if(d.data("canDelete")){a.children(".jsDeletePost").show()}}if(d.data("canEnable")&&!d.data("isDeleted")){if(d.data("isDisabled")){a.children(".jsEnablePost").show()}else{a.children(".jsDisablePost").show()}}}},_getHash:function(a){return"#post"+a}});WBB.Post.CollapsedPostLoader=Class.extend({_postHandler:null,_posts:{},_proxy:null,init:function(a){var b=this;$(a).each(function(e,f){var d=$(f).data("postID");var c=$("#post"+d);b._posts[d]=c.click($.proxy(b._loadPost,b))});if($.getLength(this._posts)){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)})}},setPostHandler:function(a){this._postHandler=a;this._postHandler.setCollapsedPostLoader(this)},loadPosts:function(a){this._proxy.setOption("data",{actionName:"getPosts",className:"wbb\\data\\post\\PostAction",objectIDs:a,parameters:{showCollapsedPosts:true}});this._proxy.sendRequest()},_loadPost:function(b){var a=$(b.target);if(a.getTagName()==="a"||a.getTagName()==="input"){return}this.loadPosts([$(b.currentTarget).children("article").data("postID")])},_success:function(c,d,b){var a=$(""+c.returnValues.template);a.each($.proxy(function(h,i){var f=$(i);if(f.is("li")){var e=f.children("article");var g=e.data("postID");if(this._posts[g]){if(a.length===1){f.hide()}this._posts[g].replaceWith(f);if(a.length===1){f.wcfFadeIn(function(){var j=new WCF.Effect.Scroll();j.scrollTo(f,true)})}if(this._postHandler){this._postHandler.setPost(g,e)}}}},this));WCF.Clipboard.reload()}});WBB.Post.IPAddressHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={};this._dialog=null;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._initButtons();WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.IPAddressHandler",$.proxy(this._initButtons,this))},_initButtons:function(){var a=this;$(".jsIpAddress").each(function(c,d){var e=$(d);var b=e.data("postID");if(a._cache[b]===undefined){a._cache[b]="";e.click($.proxy(a._click,a))}})},_click:function(b){var a=$(b.currentTarget).data("postID");if(this._cache[a]){this._showDialog(a)}else{this._proxy.setOption("data",{actionName:"getIpLog",className:"wbb\\data\\post\\PostAction",parameters:{postID:a}});this._proxy.sendRequest()}},_success:function(b,c,a){this._cache[b.returnValues.postID]=b.returnValues.template;this._showDialog(b.returnValues.postID)},_showDialog:function(a){if(this._dialog===null){this._dialog=$('<div id="wbbIpAddressLog" />').hide().appendTo(document.body)}this._dialog.html(this._cache[a]);this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.ipAddress.title")});this._dialog.wcfDialog("render")}});WBB.Post.QuoteHandler=WCF.Message.Quote.Handler.extend({init:function(a){this._super(a,"wbb\\data\\post\\PostAction","com.woltlab.wbb.post",".message",".messageBody",".messageBody > div > div.messageText")}});