WCF.Infraction={};WCF.Infraction.Suspension={};WCF.Infraction.Warning={};WCF.Infraction.Warning.Content=Class.extend({_buttons:{},_buttonSelector:"",_dialog:null,_notification:null,_objectID:0,_objectType:"",_userID:0,_proxy:null,init:function(a,b){this._objectType=a;this._buttonSelector=b;this._buttons={};this._notification=null;this._objectID=0;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._initButtons();WCF.DOMNodeInsertedHandler.addCallback("WCF.Infraction.Warn"+this._objectType.hashCode(),$.proxy(this._initButtons,this))},_initButtons:function(){var a=this;$(this._buttonSelector).each(function(c,d){var e=$(d);var b=e.wcfIdentify();if(!a._buttons[b]){a._buttons[b]=e;e.click($.proxy(a._click,a))}})},_click:function(a){this._objectID=$(a.currentTarget).data("objectID");this._userID=$(a.currentTarget).data("userID");this._proxy.setOption("data",{actionName:"prepareWarning",className:"wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",parameters:{objectID:this._objectID,objectType:this._objectType,userID:this._userID}});this._proxy.sendRequest()},_success:function(b,c,a){if(b.returnValues.warned){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.infraction.warn.success"))}this._dialog.wcfDialog("close");this._notification.show()}else{if(b.returnValues.template){this._showDialog(b.returnValues.template);if(!b.returnValues.alreadyWarned){this._dialog.find(".jsSubmitWarning").click($.proxy(this._submit,this))}}}},_showDialog:function(a){if(this._dialog===null){this._dialog=$("#infractionWarn");if(!this._dialog.length){this._dialog=$('<div id="infractionWarn" />').hide().appendTo(document.body)}}this._dialog.html(a).wcfDialog({title:WCF.Language.get("wcf.infraction.warn")}).wcfDialog("render")},_submit:function(){$("#infractionWarn .formError").removeClass("formError");$("#infractionWarn .innerError").remove();var c="",f=0,e=0,h=0,g=0,d="";var a="";var b=$("#warningIDSelectContainer input:checked").val();if(parseInt(b,10)===0){c=$("#warningTitle").val().trim();if(c==""){$("#warningTitle").closest("dl").addClass("formError");$("#warningTitle").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.empty")));return}f=$("#warningPoints").val();if(f<0){$("#warningPoints").closest("dl").addClass("formError");$("#warningPoints").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.greaterThan",{greaterThan:0})));return}e=$("#warningExpiresNever").is(":checked")?1:0;if(!e){h=$("#warningExpires").val();d=$("#warningExpiresType").val();if(h<1){$("#warningExpires").closest("dl").addClass("formError");$("#warningExpiresType").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.greaterThan",{greaterThan:1})));return}g=0;if(d=="hours"){g=h*3600}else{if(d=="days"){g=h*86400}else{if(d=="weeks"){g=h*86400*7}}}}}a=$("#warningReason").val().trim();if(a==""){$("#warningReason").closest("dl").addClass("formError");$("#warningReason").after($("<small />").addClass("innerError").text(WCF.Language.get("wcf.global.form.error.empty")));return}this._proxy.setOption("data",{actionName:"warn",className:"wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",parameters:{reason:a,title:c,points:f,expires:g,warningID:b,objectID:this._objectID,objectType:this._objectType,userID:this._userID}});this._proxy.sendRequest()}});WCF.Infraction.Warning.Profile=Class.extend({_userID:0,_warnHandler:null,init:function(a){this._userID=a;$('<li id="warnUser"><a class="button jsTooltip" title="'+WCF.Language.get("wcf.infraction.warn")+'"><span class="icon icon16 icon-legal"></span> <span class="invisible">'+WCF.Language.get("wcf.infraction.warn")+"</span></a></li>").data("userID",this._userID).prependTo($("#profileButtonContainer"));this._warnHandler=new WCF.Infraction.Warning.Content("","#warnUser")}});WCF.Infraction.Warning.Revoke=Class.extend({_buttonSelector:"",_className:"",_confirmMessage:"",_proxy:null,_rowSelector:"",_successMessage:"",init:function(){this._buttonSelector=".jsButtonWarningRevoke";this._className="wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction";this._confirmMessage="wcf.infraction.warning.revoke.confirmMessage";this._rowSelector=".jsWarningRow";this._successMessage="wcf.infraction.warning.revoke.success";this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._bindListener()},_bindListener:function(){$(this._buttonSelector).click($.proxy(this._click,this))},_click:function(b){var a=$(b.currentTarget).parents(this._rowSelector).data("objectID");WCF.System.Confirmation.show(WCF.Language.get(this._confirmMessage),$.proxy(function(c){if(c==="confirm"){this._proxy.setOption("data",{actionName:"revoke",className:this._className,objectIDs:[a]});this._proxy.sendRequest()}},this))},_success:function(b,c,a){$(this._rowSelector).each($.proxy(function(e,g){var d=$(g);if(WCF.inArray(d.data("objectID"),b.objectIDs)){d.find(this._buttonSelector).addClass("disabled").removeClass("pointer").off("click");var f=new WCF.System.Notification(WCF.Language.get(this._successMessage));f.show()}},this))}});WCF.Infraction.Suspension.Revoke=WCF.Infraction.Warning.Revoke.extend({_bindListener:function(){this._buttonSelector=".jsButtonSuspensionRevoke";this._className="wcf\\data\\user\\infraction\\suspension\\UserInfractionSuspensionAction";this._confirmMessage="wcf.infraction.suspension.revoke.confirmMessage";this._rowSelector=".jsSuspensionRow";this._successMessage="wcf.infraction.suspension.revoke.success";this._super()}});WCF.Infraction.Warning.ShowDetails=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={};this._dialog=null;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$(".jsInfractionShowDetails").click($.proxy(this._click,this))},_click:function(a){var b=$(a.currentTarget).parents(".jsWarningRow").data("objectID");if(this._cache[b]===undefined){this._proxy.setOption("data",{actionName:"getDetails",className:"wcf\\data\\user\\infraction\\warning\\UserInfractionWarningAction",objectIDs:[b]});this._proxy.sendRequest()}else{this._showDetails(b)}a.preventDefault();return false},_showDetails:function(a){if(this._dialog===null){this._dialog=$("<div />").hide().appendTo(document.body);this._dialog.html(this._cache[a]).wcfDialog({title:WCF.Language.get("wcf.infraction.warning.details")})}else{this._dialog.html(this._cache[a]).wcfDialog("open")}},_success:function(b,c,a){this._cache[b.returnValues.userWarningID]=b.returnValues.template;this._showDetails(b.returnValues.userWarningID)}});